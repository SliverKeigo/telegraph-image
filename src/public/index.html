<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8"/>
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0"/>
    <title>Telegraph 图片托管</title>

    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/4.5.3/css/bootstrap.min.css"
    />
    <style>
      @media (max-width: 600px) {
        .container {
          margin: 20px auto;
          padding: 10px;
        }

        .upload-btn-wrapper {
          padding: 5px 15px;
        }

        h2 {
          font-size: 1.5em;
        }

        p {
          font-size: 0.875em;
          line-height: 1.5;
        }
      }

      body {
        font-family: Arial, sans-serif;
        background-color: #f8f9fa;
        line-height: 1.5;
        padding: 20px;
      }

      .container {
        max-width: 600px;
        margin: 50px auto;
        padding: 20px;
        background-color: #fff;
        border-radius: 10px;
        box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
        text-align: center;
      }

      .upload-btn-wrapper {
        position: relative;
        overflow: hidden;
        display: inline-block;
        background-color: #6c5ce7;
        color: #fff;
        border-radius: 5px;
        padding: 10px 17px;
        cursor: pointer;
        transition: all ease 0.1s;
        border: none;
        outline: none;
        font-size: 12px;
        font-weight: 700;
        box-shadow: 0 5px 0 0 #a29bfe;
      }

      .upload-btn-wrapper input[type="file"] {
        font-size: 100px;
        position: absolute;
        left: 0;
        top: 0;
        opacity: 0;
      }

      .upload-btn-wrapper:active {
        transform: translateY(5px);
        box-shadow: 0 0 0 0 #a29bfe;
      }

      /* tooltip settings 👇 */

      .copy {
        /* button */
        --button-bg: #353434;
        --button-hover-bg: #464646;
        --button-text-color: #CCCCCC;
        --button-hover-text-color: #8bb9fe;
        --button-border-radius: 10px;
        --button-diameter: 36px;
        --button-outline-width: 1px;
        --button-outline-color: rgb(141, 141, 141);
        /* tooltip */
        --tooltip-bg: #f4f3f3;
        --toolptip-border-radius: 4px;
        --tooltip-font-family: Menlo, Roboto Mono, monospace;
        /* 👆 this field should not be empty */
        --tooltip-font-size: 12px;
        /* 👆 this field should not be empty */
        --tootip-text-color: rgb(50, 50, 50);
        --tooltip-padding-x: 7px;
        --tooltip-padding-y: 7px;
        --tooltip-offset: 8px;
        --tooltip-transition-duration: 0.3s;
        /* 👆 if you need a transition,
        just remove the comment,
        but I didn't like the transition :| */
      }

      .copy {
        box-sizing: border-box;
        width: var(--button-diameter);
        height: var(--button-diameter);
        border-radius: var(--button-border-radius);
        background-color: var(--button-bg);
        color: var(--button-text-color);
        border: none;
        cursor: pointer;
        position: relative;
        outline: none;
      }

      .tooltip {
        position: absolute;
        opacity: 0;
        visibility: hidden;
        top: 0;
        left: 50%;
        transform: translateX(-50%);
        white-space: nowrap;
        font: var(--tooltip-font-size) var(--tooltip-font-family);
        color: var(--tootip-text-color);
        background: var(--tooltip-bg);
        padding: var(--tooltip-padding-y) var(--tooltip-padding-x);
        border-radius: var(--toolptip-border-radius);
        pointer-events: none;
        transition: all var(--tooltip-transition-duration) cubic-bezier(0.68, -0.55, 0.265, 1.55);
      }

      .tooltip::before {
        content: attr(data-text-initial);
      }

      .tooltip::after {
        content: "";
        position: absolute;
        bottom: calc(var(--tooltip-padding-y) / 2 * -1);
        width: var(--tooltip-padding-y);
        height: var(--tooltip-padding-y);
        background: inherit;
        left: 50%;
        transform: translateX(-50%) rotate(45deg);
        z-index: -999;
        pointer-events: none;
      }

      .copy svg {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
      }

      .checkmark {
        display: none;
      }

      /* actions */

      .copy:hover .tooltip,
      .copy:focus:not(:focus-visible) .tooltip {
        opacity: 1;
        visibility: visible;
        top: calc((100% + var(--tooltip-offset)) * -1);
      }

      .copy:focus:not(:focus-visible) .tooltip::before {
        content: attr(data-text-end);
      }

      .copy:focus:not(:focus-visible) .clipboard {
        display: none;
      }

      .copy:focus:not(:focus-visible) .checkmark {
        display: block;
      }

      .copy:hover,
      .copy:focus {
        background-color: var(--button-hover-bg);
      }

      .copy:active {
        outline: var(--button-outline-width) solid var(--button-outline-color);
      }

      .copy:hover svg {
        color: var(--button-hover-text-color);
      }
    </style>
  </head>
  <body>

  <div
    class="container"
    ondragover="event.preventDefault()"
    ondrop="handleDrop(event)"
  >
    <h2 class="text-center">Telegraph 图片托管</h2>
    <p class="text-center text-muted">免费&无限制数量图片托管(文件大小不能超过 5MB)</p>
    <br/>
    <div class="upload-btn-wrapper text-center">
      <span class="upload-btn">上传图片</span>
      <input
        type="file"
        name="file"
        id="fileInput"
        accept="image/png, image/jpeg, image/jpg, image/gif"
      />
    </div>
    <div id="uploadStatus"
         style="margin-top: 20px"></div>
    <p>
      Powered By <a href="https://telegra.ph"
                    target="_blank">Telegraph</a>
    </p>
  </div>

  <script>
    const fileInput = document.getElementById("fileInput");
    const uploadStatus = document.getElementById("uploadStatus");

    function handleDrop(event) {
      event.preventDefault();
      let files = event.dataTransfer.files;
      for (let i = 0; i < files.length; i++) {
        uploadImage(files[i]);
      }
    }

    document.addEventListener("paste", (event) => {
      const items = (event.clipboardData || event.originalEvent.clipboardData)
        .items;
      for (let index in items) {
        const item = items[index];
        if (item.kind === "file") {
          const blob = item.getAsFile();
          const reader = new FileReader();
          reader.onload = (event) => {
            const base64Data = event.target.result.split(",")[1];
            const data = window.atob(base64Data);
            const ia = new Uint8Array(data.length);
            for (let i = 0; i < data.length; i++) {
              ia[i] = data.charCodeAt(i);
            }
            const blob = new Blob([ia.buffer], {type: "image/jpeg"});
            const file = new File([blob], "screenshot.jpg");
            uploadImage(file);
          };
          reader.readAsDataURL(blob);
        }
      }
    });

    fileInput.addEventListener("change", () => {
      const file = fileInput.files[0];
      if (file) {
        uploadImage(file);
      }
    });

    const uploadImage = (file) => {
      const formData = new FormData();
      formData.append("file", file);

      document.querySelector(".upload-btn").textContent = "上传中...";

      fetch("/upload", {method: "POST", body: formData})
        .then((response) => response.json())
        .then((data) => {
          const src = window.location.origin + data[0].src;
          uploadStatus.innerHTML = `
                <div class="alert alert-success">上传成功! 🥳</div>
                <div class="input-group">
                  <input type="text" class="form-control" id="imageUrl" value="${src}">
<!--                    <button class="btn btn-outline-secondary copy-btn" type="button" onclick="copyImageUrl()">复制 URL</button>-->
<button class="copy copy-btn" type="button" onclick="copyImageUrl()" style="position: absolute; top: 5px; right: 5px;">
  <span data-text-end="✨ 复制成功!" data-text-initial="复制 URL" class="tooltip"></span>
  <span>
    <svg xml:space="preserve" style="enable-background:new 0 0 512 512" viewBox="0 0 6.35 6.35" y="0" x="0" height="20" width="20" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" xmlns="http://www.w3.org/2000/svg" class="clipboard">
      <g>
        <path fill="currentColor" d="M2.43.265c-.3 0-.548.236-.573.53h-.328a.74.74 0 0 0-.735.734v3.822a.74.74 0 0 0 .735.734H4.82a.74.74 0 0 0 .735-.734V1.529a.74.74 0 0 0-.735-.735h-.328a.58.58 0 0 0-.573-.53zm0 .529h1.49c.032 0 .049.017.049.049v.431c0 .032-.017.049-.049.049H2.43c-.032 0-.05-.017-.05-.049V.843c0-.032.018-.05.05-.05zm-.901.53h.328c.026.292.274.528.573.528h1.49a.58.58 0 0 0 .573-.529h.328a.2.2 0 0 1 .206.206v3.822a.2.2 0 0 1-.206.205H1.53a.2.2 0 0 1-.206-.205V1.529a.2.2 0 0 1 .206-.206z"></path>
      </g>
    </svg>
    <svg xml:space="preserve" style="enable-background:new 0 0 512 512" viewBox="0 0 24 24" y="0" x="0" height="18" width="18" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" xmlns="http://www.w3.org/2000/svg" class="checkmark">
      <g>
        <path data-original="#000000" fill="currentColor" d="M9.707 19.121a.997.997 0 0 1-1.414 0l-5.646-5.647a1.5 1.5 0 0 1 0-2.121l.707-.707a1.5 1.5 0 0 1 2.121 0L9 14.171l9.525-9.525a1.5 1.5 0 0 1 2.121 0l.707.707a1.5 1.5 0 0 1 0 2.121z"></path>
      </g>
    </svg>
  </span>
</button>
                </div>
                <br />
                <img src="${src}" class="img-fluid mb-3" alt="Uploaded Image">
            `;
        })
        .catch((error) => {
          uploadStatus.innerHTML =
            '<div class="alert alert-danger">上传失败. 请重新尝试.</div>';
        })
        .finally(() => {
          document.querySelector(".upload-btn").textContent =
            "上传图片";
        });
    };

    const copyImageUrl = () => {
      const imageUrl = document.getElementById("imageUrl");
      imageUrl.select();
      document.execCommand("copy");
      document.querySelector(".copy-btn").textContent = "✨ 复制成功";
      setTimeout(() => {
        document.querySelector(".copy-btn").textContent = "复制 URL";
      }, 1000);
    };
  </script>
  </body>
</html>
